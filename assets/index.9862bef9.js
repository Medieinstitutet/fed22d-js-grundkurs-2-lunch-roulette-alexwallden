var S=Object.defineProperty;var O=(o,e,t)=>e in o?S(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>(O(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();class P{constructor(){r(this,"lat");r(this,"lng");this.lat=0,this.lng=0}getUserCoordinates(){return new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(n=>{this.lat=n.coords.latitude,this.lng=n.coords.longitude,e(!0)},n=>{if(n.code===1){e(null);return}t(console.error(n.message))})})}setCoordinates(e,t){this.lat=e,this.lng=t}}class E{constructor(e){r(this,"info");r(this,"marker");r(this,"infoWindow");r(this,"details");r(this,"coordinates");r(this,"distance");r(this,"isOpen");this.info=e,this.coordinates={lat:this.info.geometry.location.lat(),lng:this.info.geometry.location.lng()},this.createMarker(),this.createInfoWindow(),this.isOpen=!1}createMarker(){const e=new google.maps.Marker({position:this.coordinates});this.marker=e}createInfoWindow(){const e=new google.maps.InfoWindow({content:`<h2 style="color: black">${this.info.name}</h2>`});this.infoWindow=e}changeOpenStatus(){this.isOpen=!this.isOpen}calculateDistance(e){const n=e.position.lat()*(Math.PI/180),s=this.marker.position.lat()*(Math.PI/180),a=s-n,c=(this.marker.position.lng()-e.position.lng())*(Math.PI/180),u=2*6371.071*Math.asin(Math.sqrt(Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(s)*Math.sin(c/2)*Math.sin(c/2)));u<1?console.log(Math.floor(u*1e3)):u>=1&&console.log(Math.round(u*10)/10),this.distance=u,console.log(this.distance)}}function L(o){return new Promise(e=>{setTimeout(()=>{e()},o)})}class b{constructor(e){r(this,"restaurants",[]);r(this,"openRestaurants",[]);r(this,"closedRestaurants",[]);r(this,"map");r(this,"retrievePromises",[]);this.initMap(e)}initMap(e){this.map=new google.maps.Map(e,{zoom:4,center:{lat:63.3297408,lng:18.0158464}})}retrieveRestaurants(e,t){return new Promise(n=>{const s={location:e,radius:t,type:["restaurant"]};new google.maps.places.PlacesService(this.map).nearbySearch(s,async(c,u)=>{if(u===google.maps.places.PlacesServiceStatus.OK){switch(this.restaurants=[],c.forEach(h=>{if(h.business_status==="OPERATIONAL"){const R=new E(h);this.restaurants.push(R)}}),console.log(this.restaurants),await this.retrieveDetails(),t){case 500:this.map.setZoom(15);break;case 1e3:this.map.setZoom(14);break;case 5e3:this.map.setZoom(7);break;default:this.map.setZoom(12);break}n(c)}else n(null)})})}async retrieveDetails(){for(let e=0;e<this.restaurants.length;e++){const t=this.restaurants[e],n={placeId:t.info.place_id,fields:["name","opening_hours","utc_offset_minutes"]},s=new google.maps.places.PlacesService(this.map),a=new Promise(c=>{s.getDetails(n,(u,h)=>{console.log("Status:",h),h===google.maps.places.PlacesServiceStatus.OK?t.details=u:!h===google.maps.places.PlacesServiceStatus.OK&&c(h),c(u)})});this.retrievePromises.push(a),await L(300)}console.log(this.restaurants),await this.filterOpenRestaurants()}async filterOpenRestaurants(){await Promise.allSettled(this.retrievePromises).then(e=>{e.forEach(t=>{console.log(t)});for(let t=0;t<this.restaurants.length;t++){const n=this.restaurants[t];if(n.details.opening_hours){const s=n.details.opening_hours.isOpen();s?(n.changeOpenStatus(),this.openRestaurants.push(n)):s||this.closedRestaurants.push(n)}else this.closedRestaurants.push(n)}console.log(this.restaurants),this.restaurants.forEach(t=>{t.details.opening_hours&&console.log(t.info.name,t.details.opening_hours.isOpen())}),console.log(this.openRestaurants),console.log(this.closedRestaurants)}).catch(e=>{console.log(e)})}attachInfoWindows(){this.restaurants.forEach(e=>{e.marker.addListener("click",()=>{e.infoWindow.open({anchor:e.marker,map:this.map})})})}setMarker(e){e.setMap(this.map)}setMarkers(){this.openRestaurants.forEach(e=>{e.marker.setMap(this.map)})}removeMarkers(){this.openRestaurants.forEach(e=>{e.marker.setMap(null)})}getOpenRestaurants(){return this.openRestaurants}}const d=document.querySelector("#app"),I=document.querySelector("#map"),m=document.querySelector("#restaurants-list"),g=document.querySelector("#start-btn"),M=document.querySelector("#display-btn"),k=document.querySelector("#remove-btn"),w=document.querySelector("#roulette-btn"),q=Array.from(document.querySelectorAll('input[name="range-input"]')),i=new b(I);let f,v,y=500,l=null,p;function C(){v=new google.maps.Marker({position:l})}function W(o){const{target:e}=o;e&&(i.removeMarkers(),p&&p.setMap(null),y=Number(e.value),l&&(async()=>{await i.retrieveRestaurants(l,y)})().then(()=>{}).catch(t=>{console.log(t)}))}q.forEach(o=>{o.addEventListener("click",W)});function _(){m&&(m.innerHTML=""),console.log("Startar appen"),(async()=>{l=new P,f=await l.getUserCoordinates(),f&&d&&l&&(console.log("Koordinater h\xE4mtade!"),d.innerHTML=`Din position \xE4r ${l.lat} och ${l.lng}`),await i.retrieveRestaurants(l,y)})().then(()=>{f&&d&&l&&m?(C(),i.setMarker(v),i.map.setCenter(l),i.attachInfoWindows(),i.getOpenRestaurants().forEach(e=>{e.calculateDistance(v),m.innerHTML+=`
          <li>${e.info.name}</li>`})):d&&!f&&(d.innerHTML="Du beh\xF6ver aktivera platstj\xE4nster")}).catch(o=>{console.log("N\xE5got gick fel"),console.error(o)})}function x(){p&&p.setMap(null);const o=Math.floor(Math.random()*(i.restaurants.length-1));console.log(o);const t=i.restaurants[o].info.geometry.location,n=t.lat(),s=t.lng();p=new google.maps.Marker({position:{lat:n,lng:s}}),i.removeMarkers(),i.setMarker(p)}g==null||g.addEventListener("click",_);M==null||M.addEventListener("click",()=>{i.setMarkers()});w==null||w.addEventListener("click",x);k==null||k.addEventListener("click",()=>i.removeMarkers());
