var O=Object.defineProperty;var C=(t,e,o)=>e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var m=(t,e,o)=>(C(t,typeof e!="symbol"?e+"":e,o),o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();class E{constructor(){m(this,"lat");m(this,"lng");this.lat=0,this.lng=0}getUserCoordinates(){return new Promise((e,o)=>{navigator.geolocation.getCurrentPosition(r=>{this.lat=r.coords.latitude,this.lng=r.coords.longitude,e(!0)},r=>{if(r.code===1){e(null);return}o(console.error(r.message))})})}setCoordinates(e,o){this.lat=e,this.lng=o}}class R{constructor(e){m(this,"restaurants",[]);m(this,"map");this.initMap(e)}initMap(e){this.map=new google.maps.Map(e,{zoom:6,center:{lat:59.3297408,lng:18.0158464}})}retrieveRestaurants(e,o){return new Promise(r=>{const n={location:e,radius:o,type:["restaurant"]};new google.maps.places.PlacesService(this.map).nearbySearch(n,(l,u)=>{u===google.maps.places.PlacesServiceStatus.OK?(this.restaurants=l,r(l)):r(null)})})}setMarker(e){e.setMap(this.map)}setMarkers(e){e.forEach(o=>{o.setMap(this.map)})}}const g=document.querySelector("#app"),x=document.querySelector("#map"),k=document.querySelector("#start-btn"),y=document.querySelector("#display-btn"),M=document.querySelector("#remove-btn"),w=document.querySelector("#roulette-btn"),N=Array.from(document.querySelectorAll('input[name="range-input"]')),c=[],s=new R(x);let d=[],L,f=500,i=null,v;function _(){L=new google.maps.Marker({position:i})}function I(t,e){t.open(s.map,e)}function b(){c.forEach(t=>{t.setMap(null)}),console.log(c)}function A(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}function P(t){return new Promise(async e=>{c.length=0;for(let o=0;o<t.length;o++){const r=t[o];let n=!1;if(r.business_status==="OPERATIONAL"){console.log(r),o!==0&&await A(300);const a={placeId:r.place_id,fields:["name","opening_hours","utc_offset_minutes"]};if(new google.maps.places.PlacesService(s.map).getDetails(a,(u,p)=>{console.log(u,p),p==="OK"&&u.opening_hours&&(n=u.opening_hours.isOpen())}),console.log(n),n){const u=r.geometry.location.lat(),p=r.geometry.location.lng(),S=new E;S.setCoordinates(u,p);const h=new google.maps.Marker({position:S}),q=new google.maps.InfoWindow({content:`<h2 style="color: black">${r.name}</h2>`});h.addListener("click",()=>I(q,h)),c.push(h)}}}switch(console.log(c),f){case 500:s.map.setZoom(15);break;case 1e3:s.map.setZoom(14);break;case 3e3:s.map.setZoom(12);break;default:s.map.setZoom(12);break}e()})}function Z(t){const{target:e}=t;e&&(f=Number(e.value),(async()=>{await s.retrieveRestaurants(i,f)})().then(()=>{b(),d.length=0,d=[...s.restaurants],P(d)}).catch(o=>{console.log(o)}))}N.forEach(t=>{t.addEventListener("click",Z)});function D(){console.log("Startar appen"),(async()=>{i=new E,await i.getUserCoordinates(),await s.retrieveRestaurants(i,f)})().then(()=>{console.log("Koordinater h\xE4mtade!"),i&&g?(d=[...s.restaurants],g.innerHTML=`Din position \xE4r ${i.lat} och ${i.lng}`,_(),s.setMarker(L),s.setMarkers(c),s.map.setZoom(15),s.map.setCenter(i),P(d)):g&&(g.innerHTML="Du beh\xF6ver aktivera platstj\xE4nster")}).catch(t=>{console.log("N\xE5got gick fel"),console.error(t)})}function K(){const t=Math.floor(Math.random()*(c.length-1));console.log(t),v=c[t],b(),console.log(v),s.setMarkers([v])}k==null||k.addEventListener("click",D);y==null||y.addEventListener("click",()=>{s.setMarkers(c)});w==null||w.addEventListener("click",K);M==null||M.addEventListener("click",b);
